<!DOCTYPE html>
<html lang="en" data-theme="mint">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>StudyFlow — AI Schedule Manager</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Icon CDN (kept as CDN global) -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Firebase loader: create `assets/js/firebase-config.js` with your config or set window.__FIREBASE_CONFIG__ inline -->
  <script>
    // Optional: you can set your Firebase config here directly, or create the file assets/js/firebase-config.js
    // Example:
    // window.__FIREBASE_CONFIG__ = { apiKey: '...', authDomain: '...', databaseURL: '...', projectId: '...', storageBucket: '...', messagingSenderId: '...', appId: '...' };
  </script>
  <!-- Optional: external config file that sets window.__FIREBASE_CONFIG__ -->
  <script src="assets/js/firebase-config.js"></script>
  <script type="module" src="assets/js/firebase-loader.js"></script>
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <!-- Login splash (required) -->
  <div id="authSplash" class="modal-backdrop open" style="z-index:200;">
    <div class="modal" style="width:360px;">
      <h3>Welcome to StudyFlow</h3>
      <p>Please sign in to continue</p>
      <div style="margin-top:6px;">
        <p style="color:var(--muted); font-size:13px">Sign in quickly with Google. No password required.</p>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
        <button id="googleSignIn" class="btn google"> <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G" style="width:18px; height:18px; margin-right:8px;"> Sign in with Google</button>
      </div>
    </div>
  </div>
  <!-- The HTML structure has been preserved from the original single-file app. -->
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="brand"><div class="logo">SF</div> <span class="label">StudyFlow</span></div>
      <div class="nav" id="nav">
        <button data-nav="home" class="active"><i data-lucide="home"></i> <span class="label">Homepage</span></button>
        <button data-nav="calendar"><i data-lucide="calendar"></i> <span class="label">Calendar</span></button>
        <button data-nav="ask"><i data-lucide="bot"></i> <span class="label">Ask AI</span></button>
        <button data-nav="whiteboard"><i data-lucide="pen-tool"></i> <span class="label">Whiteboard</span></button>
      </div>
      <div style="margin-top:auto" class="card">
        <div style="font-weight:700; margin-bottom:8px">Quick Tips</div>
        <div style="color:var(--muted); font-size:13px">Calendar is the only editable view. Tap/Click a slot or day to add a lesson. Delete via the bin icon. Recurring = weekly.</div>
      </div>
    </aside>

    <!-- Main content -->
    <div class="content">
      <div class="topbar">
        <div class="topbar-left">
          <button class="icon-btn" id="toggleSidebar" aria-label="Toggle menu"><i data-lucide="panel-left"></i></button>
          <div class="segmented" id="viewToggle">
            <button data-view="weekly" class="active">Weekly</button>
            <button data-view="monthly">Monthly</button>
          </div>
        </div>
        <div class="auth" id="authBar">
            <div id="signedInControls" style="display:none">
              <span id="displayName" style="font-weight:700; margin-right:8px"></span>
              <button class="btn ghost" id="signoutBtn">Sign out</button>
            </div>
          <div class="profile" style="margin-left: 8px;">
            <div class="avatar" id="avatar">U</div>
            <button class="icon-btn" id="profileBtn" aria-label="Open profile"><i data-lucide="chevron-down"></i></button>
            <div class="menu" id="profileMenu">
              <div class="group">
                <label for="themeSelect">Theme</label>
                <select id="themeSelect">
                  <option value="mint">Green / Mint</option>
                  <option value="blue">Baby Blue</option>
                  <option value="pink">Faded Pink</option>
                  <option value="dark">Dark Mode</option>
                </select>
              </div>
              <div class="group">
                <button id="settingsBtn"><i data-lucide="settings"></i> Settings</button>
                <button id="exportBtn"><i data-lucide="download"></i> Export .json</button>
                <button id="importBtn"><i data-lucide="upload"></i> Import .json</button>
                <button id="menuSignOut" class="btn ghost" style="margin-top:8px">Sign out</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pages -->
      <section class="page active" id="homePage">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; gap:10px; flex-wrap:wrap;">
              <h2 style="margin:0">Overview</h2>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="btn secondary" id="todayBtn"><i data-lucide="calendar-days"></i> Today</button>
                <button class="btn secondary" id="prevWeek">‹</button>
                <button class="btn secondary" id="nextWeek">›</button>
              </div>
            </div>
            <div class="scroll-x">
              <div class="timetable" id="weeklyViewHome" aria-label="Weekly timetable (read-only)"></div>
              <div class="month-grid" id="monthlyViewHome" style="display:none"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="page" id="calendarPage">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; gap:10px; flex-wrap:wrap;">
              <h2 style="margin:0">Calendar</h2>
              <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
                <span id="monthLabel" style="font-weight:700"></span>
                <button class="btn secondary" id="prevMonth">‹</button>
                <button class="btn secondary" id="nextMonth">›</button>
              </div>
            </div>
            <div class="scroll-x">
              <div class="timetable" id="weeklyViewCal" aria-label="Weekly timetable (editable)"></div>
              <div class="month-grid" id="monthlyView"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="page" id="askPage">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card ai-box">
            <h2 style="margin:0">Ask AI</h2>
            <textarea id="aiInput" aria-label="Ask AI" placeholder="Try: add lesson math on 2025-09-20 color #6ee7b7 recurring"></textarea>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn" id="askBtn"><i data-lucide="sparkles"></i> Ask</button>
            </div>
            <div class="ai-hint" aria-hidden="true">
              <div class="ai-hint-title">Examples</div>
              <ul>
                <li>add lesson math on 2025-09-20 color #6ee7b7 recurring</li>
                <li>can I hang out next Friday evening?</li>
                <li>find time to hang out on 2025-09-22 for 2 hours (override)</li>
              </ul>
            </div>
            <div id="aiResponse" class="card" style="padding:12px; display:none"></div>
          </div>
        </div>
      </section>

      <section class="page" id="whiteboardPage">
        <div class="whiteboard-wrapper">
          <div class="whiteboard-sidebar card">
            <div class="whiteboard-sidebar-header">
              <h2>Whiteboards</h2>
              <button class="btn secondary" id="createWhiteboardBtn"><i data-lucide="plus"></i> New board</button>
            </div>
            <div class="whiteboard-list" id="whiteboardList" role="listbox" tabindex="0" aria-label="Your whiteboards"></div>
            <div class="whiteboard-join">
              <label for="whiteboardJoinInput">Join with code</label>
              <div class="whiteboard-join-row">
                <input id="whiteboardJoinInput" maxlength="6" placeholder="ABC123" autocomplete="off" />
                <button class="btn ghost" id="joinWhiteboardBtn">Join</button>
              </div>
            </div>
          </div>
          <div class="whiteboard-main card">
            <div class="whiteboard-main-header">
              <div>
                <h2 id="whiteboardTitle">Select a whiteboard</h2>
                <div id="whiteboardMeta" class="whiteboard-meta"></div>
              </div>
              <div class="whiteboard-main-actions">
                <button class="btn secondary" id="whiteboardShareBtn" disabled><i data-lucide="share-2"></i> Share</button>
                <button class="btn ghost" id="whiteboardLeaveBtn" disabled>Leave</button>
              </div>
            </div>
            <div class="whiteboard-info-bar" id="whiteboardInfoBar">
              <div class="whiteboard-code" id="whiteboardCode"></div>
              <div class="whiteboard-participants" id="whiteboardParticipants" role="list"></div>
            </div>
            <div class="whiteboard-toolbar" id="whiteboardToolbar" aria-label="Whiteboard tools">
              <button class="whiteboard-tool active" data-tool="pen" title="Pen"><i data-lucide="pencil"></i></button>
              <button class="whiteboard-tool" data-tool="highlighter" title="Highlighter"><i data-lucide="highlighter"></i></button>
              <button class="whiteboard-tool" data-tool="eraser" title="Eraser"><i data-lucide="eraser"></i></button>
              <div class="whiteboard-divider"></div>
              <label class="whiteboard-color">
                <input type="color" id="whiteboardColor" value="#2e2e2e" aria-label="Stroke color" />
              </label>
              <input type="range" id="whiteboardSize" min="2" max="32" value="6" aria-label="Brush size" />
              <button class="whiteboard-tool" id="whiteboardClearBtn" title="Clear board"><i data-lucide="trash-2"></i></button>
              <button class="whiteboard-tool" id="whiteboardFitBtn" title="Recenter"><i data-lucide="scan"></i></button>
            </div>
            <div class="whiteboard-stage" id="whiteboardStage">
              <canvas id="whiteboardCanvas" width="1280" height="720" role="img" aria-label="Collaborative whiteboard"></canvas>
              <div class="whiteboard-cursor-layer" id="whiteboardCursors"></div>
              <div class="whiteboard-overlay" id="whiteboardOverlay">
                <div class="whiteboard-empty-state" id="whiteboardEmptyState">
                  <i data-lucide="sparkle"></i>
                  <p>Select or create a whiteboard to start drawing</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>

  <!-- Modal: Add/Edit Event -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <h3>Add / Edit Lesson</h3>
      <div class="row">
        <div>
          <label for="evtTitle">Title</label>
          <input id="evtTitle" placeholder="e.g., Chemistry" />
        </div>
        <div>
          <label for="evtColor">Color</label>
          <input id="evtColor" type="color" value="#6ee7b7" />
        </div>
        <div>
          <label for="evtStartDate">Start date</label>
          <input id="evtStartDate" type="date" />
        </div>
        <div>
          <label for="evtStartTime">Start time</label>
          <input id="evtStartTime" type="time" />
        </div>
        <div>
          <label for="evtEndDate">End date</label>
          <input id="evtEndDate" type="date" />
        </div>
        <div>
          <label for="evtEndTime">End time</label>
          <input id="evtEndTime" type="time" />
        </div>
        <div class="full">
          <label for="evtRecurring">Recurring Weekly?</label>
          <select id="evtRecurring">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
      </div>
      <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
        <button class="btn ghost" id="cancelEvt">Cancel</button>
        <button class="btn" id="saveEvt">Save</button>
      </div>
    </div>
  </div>

  <script src="assets/js/app.js"></script>
  <script src="assets/js/whiteboard.js"></script>
  <!-- Toast container -->
  <div id="toast" style="position:fixed; right:16px; bottom:16px; z-index:9999; display:none"></div>
</body>
</html>




